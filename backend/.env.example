# =========================================================
# Vegetable Shop :: backend.env.example
# Purpose: Example environment variables for local/dev usage.
# IMPORTANT: Do not commit real secrets. For prod, use SOPS/External Secrets.
# =========================================================

# ----------[ Core App ]----------
APP_NAME="veggieshop-backend"
SPRING_PROFILES_ACTIVE="local"            # local | staging | prod | test
SERVER_PORT=8080
SERVER_SHUTDOWN="graceful"                # graceful shutdown on SIGTERM
MANAGEMENT_SERVER_PORT=8081               # Actuator port (optional)
MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE="health,info,metrics,prometheus"

# ----------[ URLs & CORS ]----------
APP_BASE_URL="http://localhost:${SERVER_PORT}"
APP_EXTERNAL_URL="http://localhost"       # External URL used by proxies
APP_CORS_ALLOWED_ORIGINS="http://localhost:3000,http://localhost"
APP_CORS_ALLOWED_METHODS="GET,POST,PUT,PATCH,DELETE,OPTIONS"
APP_CORS_ALLOWED_HEADERS="Authorization,Content-Type,Accept,Origin,User-Agent"
APP_CORS_ALLOW_CREDENTIALS=true

# ----------[ Timezone ]----------
TZ="UTC"

# ----------[ Database: Postgres ]----------
DB_HOST="localhost"
DB_PORT=5432
DB_NAME="veggieshop"
DB_SCHEMA="public"
DB_USERNAME="veggie"
DB_PASSWORD="veggie"

SPRING_DATASOURCE_URL="jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}"
SPRING_DATASOURCE_USERNAME="${DB_USERNAME}"
SPRING_DATASOURCE_PASSWORD="${DB_PASSWORD}"
SPRING_JPA_PROPERTIES_HIBERNATE_DEFAULT_SCHEMA="${DB_SCHEMA}"
SPRING_JPA_OPEN_IN_VIEW=false
SPRING_JPA_HIBERNATE_DDL_AUTO="none"      # Use Flyway for schema migrations

# ----------[ Flyway ]----------
SPRING_FLYWAY_ENABLED=true
SPRING_FLYWAY_BASELINE_ON_MIGRATE=true
SPRING_FLYWAY_SCHEMAS="${DB_SCHEMA}"
SPRING_FLYWAY_LOCATIONS="classpath:db/migration"
# Example placeholders (uncomment if used by SQL):
# SPRING_FLYWAY_PLACEHOLDERS_APP_SCHEMA="${DB_SCHEMA}"

# ----------[ Messaging: Kafka / Outbox ]----------
KAFKA_ENABLED=true
KAFKA_BOOTSTRAP_SERVERS="localhost:9092"
KAFKA_CLIENT_ID="${APP_NAME}"
KAFKA_CONSUMER_GROUP_ID="${APP_NAME}-group"

SPRING_KAFKA_BOOTSTRAP_SERVERS="${KAFKA_BOOTSTRAP_SERVERS}"
SPRING_KAFKA_PRODUCER_ACKS="all"
SPRING_KAFKA_PRODUCER_RETRIES=10
SPRING_KAFKA_PRODUCER_PROPERTIES_DELIVERY_TIMEOUT_MS=120000
SPRING_KAFKA_PROPERTIES_MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION=1
SPRING_KAFKA_CONSUMER_GROUP_ID="${KAFKA_CONSUMER_GROUP_ID}"
SPRING_KAFKA_CONSUMER_AUTO_OFFSET_RESET="earliest"

# For secured clusters (uncomment and configure):
# SPRING_KAFKA_PROPERTIES_SECURITY_PROTOCOL="SASL_SSL"
# SPRING_KAFKA_PROPERTIES_SASL_MECHANISM="PLAIN"
# SPRING_KAFKA_PROPERTIES_SASL_JAAS_CONFIG="org.apache.kafka.common.security.plain.PlainLoginModule required username='__token__' password='<CHANGE_ME>';"

# ----------[ Cache ]----------
SPRING_CACHE_TYPE="simple"                 # simple | caffeine | redis
REDIS_HOST="localhost"
REDIS_PORT=6379
SPRING_DATA_REDIS_HOST="${REDIS_HOST}"
SPRING_DATA_REDIS_PORT="${REDIS_PORT}"

# ----------[ Security / JWT ]----------
AUTH_JWT_ISSUER="veggieshop"
AUTH_JWT_SECRET="<CHANGE_ME_LONG_RANDOM_SECRET>"   # Strong random secret (>=32 chars)
AUTH_ACCESS_TOKEN_TTL_MIN=30
AUTH_REFRESH_TOKEN_TTL_DAYS=30
AUTH_REQUIRE_MFA=false

# ----------[ Password Policy ]----------
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_DIGIT=true
PASSWORD_REQUIRE_SYMBOL=true

# ----------[ OAuth (Google) – optional ]----------
SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_ID="<GOOGLE_CLIENT_ID>"
SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_SECRET="<GOOGLE_CLIENT_SECRET>"
SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_SCOPE="openid,profile,email"
SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_REDIRECT_URI="${APP_EXTERNAL_URL}/login/oauth2/code/google"
SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_GOOGLE_ISSUER_URI="https://accounts.google.com"

# ----------[ Mail / Notifications ]----------
MAIL_ENABLED=true
SPRING_MAIL_HOST="localhost"
SPRING_MAIL_PORT=1025
SPRING_MAIL_USERNAME=""
SPRING_MAIL_PASSWORD=""
SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH=false
SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE=false
MAIL_FROM="no-reply@veggieshop.local"
MAIL_DISPLAY_NAME="Veggie Shop"
NOTIFICATION_CHANNELS="email"             # e.g. email,sms,push

# ----------[ Media / File Storage ]----------
MEDIA_STORAGE="local"                      # local | s3 | minio
MEDIA_LOCAL_BASE_PATH="./data/media"
MEDIA_BASE_URL="${APP_EXTERNAL_URL}/media"

# S3/MinIO (use AWS_* for common SDKs)
AWS_ACCESS_KEY_ID="<CHANGE_ME>"
AWS_SECRET_ACCESS_KEY="<CHANGE_ME>"
S3_BUCKET="veggieshop-media"
S3_REGION="us-east-1"
S3_ENDPOINT=""                              # e.g. http://localhost:9000 for MinIO
S3_PATH_STYLE_ACCESS=true                   # true for MinIO

# ----------[ Observability ]----------
LOGGING_LEVEL_ROOT="INFO"
LOGGING_LEVEL_COM_VEGGIESHOP="INFO"

# OpenTelemetry (optional)
OTEL_SERVICE_NAME="${APP_NAME}"
OTEL_EXPORTER_OTLP_ENDPOINT="http://localhost:4317"
OTEL_TRACES_EXPORTER="otlp"
OTEL_METRICS_EXPORTER="none"
OTEL_LOGS_EXPORTER="none"
OTEL_TRACES_SAMPLER="parentbased_always_on"

# ----------[ Rate Limiting ]----------
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=120

# ----------[ Proxy / Forwarded Headers ]----------
PROXY_TRUST_X_FORWARDED=true

# ----------[ Outbox/Inbox/Jobs – optional ]----------
OUTBOX_RELAY_ENABLED=true
OUTBOX_RELAY_INTERVAL_MS=1000
INBOX_CLEANUP_ENABLED=true
INBOX_CLEANUP_TTL_DAYS=7
JOBS_POLL_INTERVAL_MS=1000

# ----------[ Swagger / OpenAPI ]----------
SPRINGDOC_API_DOCS_ENABLED=true
SPRINGDOC_SWAGGER_UI_ENABLED=true
SPRINGDOC_SWAGGER_UI_PATH="/swagger-ui.html"

# ----------[ Java / JVM ]----------
JAVA_TOOL_OPTIONS="-XX:+UseG1GC -XX:MaxRAMPercentage=75.0 -XX:InitialRAMPercentage=50.0 -Dfile.encoding=UTF-8"
SPRING_MAIN_BANNER_MODE="console"          # off|console|log

# =========================================================
# Suggested production overrides (example – adjust to your infra)
# SPRING_PROFILES_ACTIVE="prod"
# APP_EXTERNAL_URL="https://api.veggieshop.yourdomain.com"
# APP_CORS_ALLOWED_ORIGINS="https://app.yourdomain.com"
# SERVER_PORT=8080
# KAFKA_BOOTSTRAP_SERVERS="kafka-1:9092,kafka-2:9092"
# SPRING_CACHE_TYPE="redis"
# REDIS_HOST="redis"
# MAIL_ENABLED=true
# SPRING_MAIL_HOST="smtp.yourprovider.com"
# SPRING_MAIL_PORT=587
# SPRING_MAIL_USERNAME="apikey"
# SPRING_MAIL_PASSWORD="<CHANGE_ME>"
# SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH=true
# SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE=true
# MEDIA_STORAGE="s3"
# S3_BUCKET="your-prod-bucket"
# S3_REGION="eu-central-1"
# OTEL_EXPORTER_OTLP_ENDPOINT="http://otel-collector:4317"
# LOGGING_LEVEL_ROOT="INFO"
# AUTH_JWT_SECRET="<VERY_LONG_SECURE_RANDOM>"
# =========================================================
